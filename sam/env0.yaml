version: 2

deploy:
  steps:
    setupVariables:
      after:
      - name: "Install SAM CLI"
        run: |
          echo "Please ensure an environment variable is configured the CloudFormation template file name as configured in the template!! --> translated_template.yaml"
          # Install dependencies
          apt-get update && apt-get install -y \
              unzip \
              zip \
              curl \
              git \
              python3 \
              python3-pip

          # Install AWS CLI (required for SAM CLI)
          curl "https://awscli.amazonaws.com/awscli-exe-linux-x86_64.zip" -o "awscliv2.zip"
          unzip awscliv2.zip && ./aws/install

          # Install SAM CLI via pip
          pip3 install aws-sam-cli

          # Verify installation
          sam --version

      - name: "Run SAM Translate"
        run: |
          sam translate --template-file template.yaml --output-template-file translated-template.yaml
      - name: "Validate Generated CloudFormation Template"
        run: |
          aws cloudformation validate-template --template-body file://translated-template.yaml

